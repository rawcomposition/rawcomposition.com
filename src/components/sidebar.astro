---
//import speciesPhotos from "../../public/lifelist_date_sorted.json";
import { getCountryName } from "../helpers/ebird.js";
import CountryRow from "./country-row.astro";
const profileId = import.meta.env.PUBLIC_EBIRD_PROFILE_ID;
//const totalCount = speciesPhotos.length;
const request = await fetch(`https://ebird.org/prof/count/species?username=${profileId}&r=world`);
const json = await request.json();
const countries = json.map(country => ({ code: country[0], count: parseInt(country[1]) }));
countries.sort((a, b) => b.count - a.count);
---
<div class="bg-white p-10 w-full md:w-[33%] text-sm">
	<div class="text-center mb-12">
		<img class="w-[150px] rounded-full inline-block" src="/avatar.jpg" alt=""/>
		<div>
			<h4 class="text-[#636467] uppercase font-bold font-heading mb-2 mt-6">Adam Jackson</h4>
			<p class="text-[0.85rem] text-zinc-500/80">I'm a web developer that loves chasing rare birds around world. I developed an interest in bird photography at the age of 12 while living in Tasmania and started getting more serious about birding in 2016.</p>
		</div>
	</div>
	<h4 class="text-[#636467] uppercase font-bold font-heading mb-4">Birding Life List</h4>

	<details class="text-zinc-600">
		<summary class="relative marker-none">
			<ol class="bg-zebra">
				<CountryRow country="World" count="totalCount" link="/lifelist"/>
				{countries.slice(0,5).map(({code, count}) => (
					<CountryRow country={getCountryName(code)} count={count}/>
				))}
			</ol>
			<div class="text-center text-orange cursor-pointer absolute left-0 right-0 bottom-0 p-2 bg-gradient-to-t from-white to-transparent hide-on-open">View More</div>
		</summary>
		<ol class="bg-zebra">
			{countries.slice(5).map(({code, count}) => (
				<CountryRow country={getCountryName(code)} count={count}/>
			))}
		</ol>
	</details>
</div>
