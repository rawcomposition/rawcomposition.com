---
import { getCollection, getEntry, render } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import TripMeta from '../../components/TripMeta.astro';
import EbirdImage from '../../components/EbirdImage.astro';
import { getEbirdImgUrl } from '../../helpers/ebird';
import { SITE_DESCRIPTION } from '../../consts';

export async function getStaticPaths() {
	const trips = await getCollection('trips');
	return trips.map((trip) => ({
		params: { slug: trip.id },
	}));
}

const { slug } = Astro.params;
const trip = await getEntry('trips', slug);
if (!trip) {
	throw new Error(`Trip not found: ${slug}`);
}
const { Content } = await render(trip);
const { title, month, length, species, lifers, isUS, featuredImg, ebirdLink, subtitle } = trip.data;
const heroImg = featuredImg ? getEbirdImgUrl(featuredImg, 2400) : '';
const description = subtitle || SITE_DESCRIPTION;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`${title} | RawComposition.com`} description={description} />
	</head>
	<body>
		<Header noMargin />
		<div class="bg-neutral-800/90 p-2">
			<div class="mx-auto max-w-[1200px] px-4 text-gray-400 text-xs sm:text-sm">
				<a href="/" class="text-gray-200">Trip Reports</a>
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512" class="icon mx-1.5">
					<path fill="currentColor" d="M224 256c0 1.1-.7344 3.969-2.219 5.531l-144 151.1c-3.047 3.187-8.125 3.312-11.31 .25c-3.188-3.094-3.281-8.156-.25-11.31l138.7-146.5L66.21 109.5C63.18 106.3 63.27 101.3 66.46 98.22c3.188-3.062 8.266-2.937 11.31 .25l144 151.1C223.3 252 224 254 224 256z" />
				</svg>
				{title}
			</div>
		</div>
		{featuredImg && <img src={heroImg} alt="" class="w-full object-cover aspect-[2]" />}
		<div class={`mx-auto max-w-4xl px-4 flex flex-col ${featuredImg ? '-mt-16' : ''}`}>
			<div class="flex-1 p-4 sm:p-12 pt-3 sm:pt-10 bg-white mb-4 prose prose-headings:font-heading prose-headings:text-neutral-600 prose-a:text-orange prose-img:mt-0 prose-hr:my-8 max-w-full">
				<span class="text-xs font-medium px-1.5 py-[3px] rounded bg-blue-100 text-blue-800 opacity-70">
					{month}
				</span>
				<h1 class="font-heading text-neutral-600 text-4xl mb-4 mt-1">{title}</h1>
				<div class="flex gap-6 flex-wrap gap-y-3 mb-10">
					<TripMeta {...{ length, species, lifers, isUS, ebirdLink, subtitle }} />
				</div>
				<Content components={{ EbirdImage }} />
			</div>
			<a href="/" class="text-lg text-gray-600 inline-flex items-center gap-1">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon">
					<path fill="currentColor" d="M447.1 256c0 13.25-10.76 24.01-24.01 24.01H83.9l132.7 126.6c9.625 9.156 9.969 24.41 .8125 33.94c-9.156 9.594-24.34 9.938-33.94 .8125l-176-168C2.695 268.9 .0078 262.6 .0078 256S2.695 243.2 7.445 238.6l176-168C193 61.51 208.2 61.85 217.4 71.45c9.156 9.5 8.812 24.75-.8125 33.94l-132.7 126.6h340.1C437.2 232 447.1 242.8 447.1 256z" />
				</svg>
				Back to trips
			</a>
		</div>
	</body>
</html>
